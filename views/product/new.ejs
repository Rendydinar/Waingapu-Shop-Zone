<% layout('layouts/boilerplate') -%>
<style>
	#imageproductupdloaded img {
		width: 90px;
		height: 60px;
		object-position: center;
		object-fit: cover;
	}

/*Banner open/load animation*/
	.alert-banner {
		-webkit-animation: slide-in-top 0.5s cubic-bezier(0.250, 0.460, 0.450, 0.940) both;
				animation: slide-in-top 0.5s cubic-bezier(0.250, 0.460, 0.450, 0.940) both;
	}

	/*Banner close animation*/
	.alert-banner input:checked ~ * {
		-webkit-animation: slide-out-top 0.5s cubic-bezier(0.550, 0.085, 0.680, 0.530) both;
				animation: slide-out-top 0.5s cubic-bezier(0.550, 0.085, 0.680, 0.530) both;		
	}

	/*Footer open/load animation*/
	.alert-footer {
		-webkit-animation: slide-in-bottom 0.5s cubic-bezier(0.250, 0.460, 0.450, 0.940) both;
				animation: slide-in-bottom 0.5s cubic-bezier(0.250, 0.460, 0.450, 0.940) both;	
	}

	/*Footer close animation*/
	.alert-footer input:checked ~ * {
		-webkit-animation: slide-out-bottom 0.5s cubic-bezier(0.550, 0.085, 0.680, 0.530) both;
				animation: slide-out-bottom 0.5s cubic-bezier(0.550, 0.085, 0.680, 0.530) both;
	}

	/*Toast open/load animation*/
	.alert-toast {
		-webkit-animation: slide-in-right 0.5s cubic-bezier(0.250, 0.460, 0.450, 0.940) both;
				animation: slide-in-right 0.5s cubic-bezier(0.250, 0.460, 0.450, 0.940) both;
	}

	/*Toast close animation*/
	.alert-toast input:checked ~ * {
		-webkit-animation: fade-out-right 0.7s cubic-bezier(0.250, 0.460, 0.450, 0.940) both;
				animation: fade-out-right 0.7s cubic-bezier(0.250, 0.460, 0.450, 0.940) both;
	}

	/* -------------------------------------------------------------
	 * Animations generated using Animista * w: http://animista.net, 
	 * ---------------------------------------------------------- */

	@-webkit-keyframes slide-in-top{0%{-webkit-transform:translateY(-1000px);transform:translateY(-1000px);opacity:0}100%{-webkit-transform:translateY(0);transform:translateY(0);opacity:1}}@keyframes slide-in-top{0%{-webkit-transform:translateY(-1000px);transform:translateY(-1000px);opacity:0}100%{-webkit-transform:translateY(0);transform:translateY(0);opacity:1}}@-webkit-keyframes slide-out-top{0%{-webkit-transform:translateY(0);transform:translateY(0);opacity:1}100%{-webkit-transform:translateY(-1000px);transform:translateY(-1000px);opacity:0}}@keyframes slide-out-top{0%{-webkit-transform:translateY(0);transform:translateY(0);opacity:1}100%{-webkit-transform:translateY(-1000px);transform:translateY(-1000px);opacity:0}}@-webkit-keyframes slide-in-bottom{0%{-webkit-transform:translateY(1000px);transform:translateY(1000px);opacity:0}100%{-webkit-transform:translateY(0);transform:translateY(0);opacity:1}}@keyframes slide-in-bottom{0%{-webkit-transform:translateY(1000px);transform:translateY(1000px);opacity:0}100%{-webkit-transform:translateY(0);transform:translateY(0);opacity:1}}@-webkit-keyframes slide-out-bottom{0%{-webkit-transform:translateY(0);transform:translateY(0);opacity:1}100%{-webkit-transform:translateY(1000px);transform:translateY(1000px);opacity:0}}@keyframes slide-out-bottom{0%{-webkit-transform:translateY(0);transform:translateY(0);opacity:1}100%{-webkit-transform:translateY(1000px);transform:translateY(1000px);opacity:0}}@-webkit-keyframes slide-in-right{0%{-webkit-transform:translateX(1000px);transform:translateX(1000px);opacity:0}100%{-webkit-transform:translateX(0);transform:translateX(0);opacity:1}}@keyframes slide-in-right{0%{-webkit-transform:translateX(1000px);transform:translateX(1000px);opacity:0}100%{-webkit-transform:translateX(0);transform:translateX(0);opacity:1}}@-webkit-keyframes fade-out-right{0%{-webkit-transform:translateX(0);transform:translateX(0);opacity:1}100%{-webkit-transform:translateX(50px);transform:translateX(50px);opacity:0}}@keyframes fade-out-right{0%{-webkit-transform:translateX(0);transform:translateX(0);opacity:1}100%{-webkit-transform:translateX(50px);transform:translateX(50px);opacity:0}}

</style>
 
<section  class="xl:p-0 lg:p-0 md:p-0 p-4" id="newproduct">
	<!-- <p class="rounded-full mr-auto text-4xl text-center mt-4">Waingapu Shop Zone</p> -->
	<div class="flex items-center w-full bg-teal-lighter">
	  <div class="w-full xl:w-xl lg:w-xl bg-white rounded shadow-lg xl:p-8 lg:p-8 p-4 md:max-w-xl md:mx-auto">
	  	<div class="text-left xl:mb-8 lg:mb-8 md:mb-8 mb-4">
		    <p class="xl:text-3xl lg:text-3xl text-xl w-full text-grey-darkest">Tambah Penjualan</p>
		    <p class="xl:text-xl lg:text-xl text-sm w-full text-grey-darkest">Buat Barang Penjualan Sekarang</p>
	  	</div>
 	    <form class="mb-4 md:flex md:flex-wrap md:justify-between" enctype="multipart/form-data" action="/products" method="POST">
	
	    	<div class="flex flex-col xl:mb-4 lg:mb-4 mb-2 md:w-full">
		        <label class="xl:mb-2 lg:mb-2 m-1 text-sm text-grey-darkest" for="title">Nama Barang</label>
				<input class="xl:text-sm lg:text-sm md:text-sm text-xs border xl:py-2 xl:px-3 lg:py-2 lg:px-3 py-1 px-2 text-grey-darkest" id="title" type="text" name="product[title]" placeholder="Title" value="<%= title %>" required>
		    </div>


	        <label class="xl:mb-2 lg:mb-2 m-1 text-sm text-grey-darkest" for="price">@ Harga</label>
			<div class="flex flex-wrap items-stretch w-full xl:mb-4 lg:mb-4 mb-2 relative">
	 			<div class="flex -mr-px">
					<span class="flex items-center leading-normal bg-grey-lighter rounded rounded-r-none border border-r-0 border-grey-light xl:px-3 lg:px-3 px-2 whitespace-no-wrap text-grey-dark xl:text-sm lg:text-sm md:text-sm text-xs">Rp.</span>
				</div>				
				<!-- <input type="text" class="flex-shrink flex-grow flex-auto leading-normal w-px flex-1 border h-10 border-grey-light px-3 relative" > -->
				<input type="text" name="product[price]" step="1000" class="xl:text-sm lg:text-sm md:text-sm text-xs border xl:py-2 xl:px-3 lg:py-2 lg:px-3 py-1 px-2 text-grey-darkest flex-shrink flex-grow flex-auto leading-normal w-px flex-1 border h-10 border-grey-light px-3 relative" placeholder="Price" id="price" value="<%= price %>" required>
			</div>			
				
			<div class="flex flex-col xl:mb-4 lg:mb-4 mb-2 md:w-full">
	        	<label class="xl:mb-2 lg:mb-2 xl:m-1 lg:m-1 m-0 text-sm text-grey-darkest" for="categori">Categori</label>
				<input type="text" name="product[categori]" step="1000" class="xl:text-sm lg:text-sm md:text-sm text-xs border xl:py-2 xl:px-3 lg:py-2 lg:px-3 py-1 px-2 text-grey-darkest" placeholder=" product, max 1" id="categori" value="<%= categori %>" required>
	     	</div>

	        <div class="flex flex-col xl:mb-6 lg:mb-6 mb-3 md:w-full">
		        <label class="xl:mb-2 lg:mb-2 xl:m-1 lg:m-1 m-0 text-sm text-grey-darkest" for="stok">Stok</label>
		        <input type="text" name="product[stok]" min="1" class="xl:text-sm lg:text-sm md:text-sm text-xs border xl:py-2 xl:px-3 lg:py-2 lg:px-3 py-1 px-2 text-grey-darkest" value="<%= stok %>" placeholder="Stok" id="stok" required>
	        </div>

	        <div class="flex flex-col xl:mb-4 lg:mb-4 mb-2 md:w-full">
		        <label class="xl:mb-2 lg:mb-2 xl:m-1 lg:m-1 m-0 xl:mt-4 lg:mt-4 mt-0 text-sm text-grey-darkest" for="rePassword">Lokasi Penjualan</label>
				<div class="flex flex-wrap items-stretch w-full relative text-grey-darkest">
					<div class="flex -mr-px">
						<span class="flex items-center leading-normal bg-grey-lighter rounded rounded-r-none border border-r-0 border-grey-light xl:px-3 lg:px-3 px-2 whitespace-no-wrap text-grey-darkest text-sm"><i class="fas fa-map-marker-alt"></i></span>
					</div>	
					<input type="text" name="product[location]" placeholder="Lokasi" class="xl:text-sm lg:text-sm md:text-sm text-xs flex-shrink flex-grow flex-auto leading-normal xl:py-2 xl:px-3 lg:py-2 lg:px-3 py-1 px-2 w-px flex-1 border border-grey-light rounded rounded-l-none px-3 relative focus:border-blue focus:shadow text-sm" id="location" value="<%= location %>" required>					
				</div>	
 	      	</div>


			<div class="w-full bg-grey-lightest font-sans">
		        <div class="border rounded flex flex-col shadow bg-white w-full">
			        <div class="box__title bg-grey-lighter px-3 py-2 border-b"><h3 class="text-sm text-grey-darker font-medium">Deskripsi Barang</h3></div>
			        <!-- <textarea placeholder="hey" class="text-grey-darkest flex-1 p-2 m-1 bg-transparent" rows="10" name="tt"></textarea> -->
			        <textarea name="product[description]" placeholder="Deskripsi Barang...." class="xl:text-sm lg:text-sm md:text-sm text-xs text-grey-darkest flex-1 p-2 m-1 bg-transparent" rows="10" required><%= description %></textarea>
		      	</div>
			</div>


	        <div class="flex flex-col xl:mb-4 lg:mb-4 mb-2 mt-4 md:w-full text-sm">
 	        	<input class="border xl:py-2 xl:px-3 lg:py-2 lg:px-3 py-1 px-2 text-grey-darkest" type="file" multiple="multiple" accept="image/*" name="images" id="imageproductupdload">
			</div>
			<div class="flex items-center justify-between" id="imageproductupdloaded">
 				
			</div>
   
	      <button class="block bg-teal-300 hover:bg-teal-dark text-sm mx-auto xl:my-6 xl:p-4 lg:my-6 lg:p-4 my-3 p-2 rounded-full w-full" type="submit">Jual Barang</button>

	    </form>
	   	
	  </div>
	</div>
	
</section>
 
 <script>
 	let categoriInput = document.getElementById('categori');


	// Restricts input for the given textbox to the given inputFilter function.
	function setInputFilter(textbox, inputFilter) {
	  ["input", "keydown", "keyup", "mousedown", "mouseup", "select", "contextmenu", "drop"].forEach(function(event) {
	    textbox.addEventListener(event, function() {
	      if (inputFilter(this.value)) {
	        this.oldValue = this.value;
	        this.oldSelectionStart = this.selectionStart;
	        this.oldSelectionEnd = this.selectionEnd;
	      } else if (this.hasOwnProperty("oldValue")) {
	        this.value = this.oldValue;
	        this.setSelectionRange(this.oldSelectionStart, this.oldSelectionEnd);
	      } else {
	        this.value = "";
	      }
	    });
	  });
	}

	setInputFilter(document.getElementById("price"), function(value) {
	  return /^[0-9]*$/.test(value); // Allow digits and '.' only, using a RegExp
	});

	setInputFilter(document.getElementById("stok"), function(value) {
	  return /^[0-9]*$/.test(value); // Allow digits and '.' only, using a RegExp
	});

	// setInputFilter(document.getElementById("location"), function(value) {
	//   return /^([a-zA-Z]+)$/.test(value); // Allow digits and '.' only, using a RegExp
	// });

	categoriInput.addEventListener('keypress', function (event) {  
	   var key = event.keyCode;
	    if (key === 32) {
	      event.preventDefault();
	    }
	});



	$(function() {
	    // Multiple images preview in browser
	    var imagesPreview = function(input, placeToInsertImagePreview) {
	        if (input.files) {
	            var filesAmount = input.files.length;
	            console.log(input.files);

	            // batas file size 1010000 = 1.01 mb
	            let isFileSizeLarge = false;

	            for( const file of input.files) {
	            	if(file.size > 1010000) isFileSizeLarge = true;
	            }
	            
	            if(filesAmount > 3 || isFileSizeLarge) {	
	            	document.querySelector('#imageproductupdloaded').innerHTML = `
						<div class="alert-toast w-full">
					    <input type="checkbox" class="hidden" id="footertoast">

					    <label class="close cursor-pointer flex items-start justify-between w-full p-2 bg-red-500 h-24 rounded shadow-lg text-white" title="close" for="footertoast">
					      Maaf, foto hanya bisa anda muat maksimal 3 buah (@ 1mb) foto. 
					    
					      <svg class="fill-current text-white" xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 18 18">
					        <path d="M14.53 4.53l-1.06-1.06L9 7.94 4.53 3.47 3.47 4.53 7.94 9l-4.47 4.47 1.06 1.06L9 10.06l4.47 4.47 1.06-1.06L10.06 9z"></path>
					      </svg>
					    </label>
					  </div>	
	            	`;		
	            	document.querySelector('#imageproductupdload').value = '';
	            } else {
		            for (i = 0; i < filesAmount; i++) {
		                var reader = new FileReader();

		                reader.onload = function(event) {
		                    $($.parseHTML('<img>')).attr('src', event.target.result ).appendTo(placeToInsertImagePreview);
		                }

		                reader.readAsDataURL(input.files[i]);
		            }
	            }
	        }
	    };

	    $('#imageproductupdload').on('change', function() {
					// remove image sebelumnya
					$("#imageproductupdloaded img").remove()
	        imagesPreview(this, 'div#imageproductupdloaded');
	    });

	});
 </script>